## README

### Описание и установка

Чистый, минималистичный конфиг, который превращает Vim в полноценную IDE. Я долгое время пользовался пустым конфигом с `Plug 'tpope/vim-sensible'`. Потом решил настроить работу с `Coc.nvim` и `ALE`. Но я так и не смог запомнить все сочетания клавиш, мне не нужна была большая часть функционала, поэтому я остановился на связке `vim-lsp` + `autocomplete`.

Чтобы скопировать себе:

```sh
git clone https://github.com/s3rgeym/vimrc.git ~/.vim
```

**LSP** — это протокол, придуманный в Microsoft... Он предоставляет линтинг, автодополнение и рефакторинг. Для поддержки LSP в моем конфиге используется `vim-lsp`. Однако, он требует ручной настройки различных language server'ов. Для автоматической же я использую `vim-lsp-settings`. Для вывода результатов автоподстановки нужны `asyncomplete.vim` и `asyncomplete-lsp.vim`.

Для поддержки Python нужно поставить [python-lsp-server](https://github.com/python-lsp/python-lsp-server) и его зависимости:

```sh
sudo pacman -S python-lsp-server autopep8 flake8 python-pylint python-rope
```

Для VimScript, если подключен репозиторий `archlinuxcn` или `chaotic-aur`:

```sh
sudo pacman -S vim-language-server
```

Языковые сервера так же можно ставить прямо из Vim:

```vim
:LspInstallServer vim-language-server
```

Но я считаю способ через пакетный менеджер самым предпочтительным. Через него можно так же ставить плагины для Vim, но в репозиториях арча нет всех нужных.

Для поиска по файлам и буферам:

```sh
sudo pacman -S fzf ripgrep
```

### Сочетания клавиш

Данные сочетания могут измениться, так что проверяем `settings/keymaps.vim`.

#### Общие сочетания

| Сочетание | Режим   | Действие                             |
| --------- | ------- | ------------------------------------ |
| `F2`      | normal  | Переключить вставку без автоформата  |
| `Q`       | normal  | Отключён (Ex mode)                   |
| `>` / `<` | normal  | Увеличить/уменьшить отступ           |
| `<` / `>` | visual  | То же, с повторным выделением        |
| `Ctrl+A`  | normal, visual  | Выделить весь текст                  |
| `Space V` | normal  | Выделить последний вставленный текст |
| `Ctrl+S`  | normal  | Сохранить файл                       |
| `Ctrl+S`  | insert  | Сохранить файл                       |
| `:w!!`    | command | Сохранить с sudo                     |

---

#### Навигация по окнам и буферам

| Сочетание           | Режим  | Действие                     |
| ------------------- | ------ | ---------------------------- |
| `Ctrl+H/J/K/L`      | normal | Перемещение между окнами     |
| `Alt+↑/↓`           | normal | Изменить высоту окна         |
| `Alt+←/→`           | normal | Изменить ширину окна         |
| `Ctrl+↑/↓`          | normal | Переключение между буферами  |
| `Tab` / `Shift+Tab` | normal | Переключение между табами    |
| `Space h`           | normal | Разделить окно горизонтально |
| `Space v`           | normal | Разделить окно вертикально   |
| `Ctrl+Q`            | normal | Закрыть текущий буфер        |
| `Ctrl+X`            | normal | Закрыть текущее окно         |

---

#### Поиск и замена

| Сочетание  | Режим  | Действие                  |
| ---------- | ------ | ------------------------- |
| `Space n`  | normal | Очистить подсветку поиска |
| `Space ev` | normal | Открыть `vimrc`           |
| `Space sv` | normal | Применить `vimrc`         |
| `Space r`  | normal | Замена слова под курсором |
| `Space r`  | visual | Замена выделенного текста |

---

#### Разное

| Сочетание   | Режим    | Действие                         |
| ----------- | -------- | -------------------------------- |
| `Space ss`  | normal   | Вкл/выкл проверку орфографии     |
| `Ctrl+амперсанд` | normal, terminal   | Показать/скрыть терминал                 |
| `Ctrl+N`    | normal   | Вкл/выкл `NERDTree`              |
| `Space f`   | normal   | Поиск файлов через `fzf`         |
| `Space /`   | normal   | Глобальный поиск через `ripgrep` |
| `Space b`   | normal   | Список буферов                   |

---

#### LSP

| Сочетание   | Режим   | Действие                              |
| ----------- | ------- | ------------------------------------- |
| `gd`        | normal  | Перейти к определению                 |
| `gi`        | normal  | Перейти к реализации                  |
| `gt`        | normal  | Перейти к типу                        |
| `gr`        | normal  | Поиск всех использований              |
| `gs`        | normal  | Символы документа                     |
| `gS`        | normal  | Символы проекта                       |
| `Space rn`  | normal  | Переименование                        |
| `[g` / `]g` | normal  | Пред./след. диагностическое сообщение |
| `K`         | normal  | Показ документации                    |
| `Ctrl+F/D`  | в hover | Прокрутка вверх/вниз                  |

---

#### Автодополнение

| Сочетание    | Режим  | Действие                              |
| ------------ | ------ | ------------------------------------- |
| `Tab`        | insert | Следующий элемент                     |
| `Shift+Tab`  | insert | Предыдущий элемент                    |
| `Enter`      | insert | Принять (если автодополнение активно) |
| `Ctrl+Space` | insert | Принудительно показать автодополнение |

---

#### Отладка

| Сочетание  | Режим  | Действие                                |
| ---------- | ------ | --------------------------------------- |
| `F5`       | normal | Старт / продолжить                      |
| `F3`       | normal | Пошаговое выполнение (Step Into)        |
| `F2`       | normal | Переход на следующую строку (Step Over) |
| `F12`      | normal | Выход из функции (Step Out)             |
| `F9`       | normal | Переключить брейкпоинт                  |
| `Space di` | normal | Показать значение под курсором          |
| `Space di` | visual | Показать значение выделенного           |

---

### Переключение раскладки

В Vim неудобно постоянно переключать системную раскладку при редактировании, так как на русской перестают работать привязки. Решением является использование встроенной поддержки русской раскладки. Переключиться в нее можно с помощью `<C-^>` (`Ctrl-6`), при этом все привязки будут работать.

### Отладка

#### Встроенный дебаггер

Для отладки C кода есть встроенный `thermdebug`, который нужно включить:

```vim
packadd thermdebug
```

> В vim давно есть поддержка плагинов, но до сих пор приходиться пользоваться сторонними, так как нет поддержки обновления плагинов

Он работает с `gdb`.

#### Python

Для использования встроенного отладчика питон я добавил [самописный плагин](./ftplugin/python_debug.vim) со сл сочетаниями:

* `F5` — запустить отладчик.
* `F9` — добавить/удалить breakpoint.
* `F10` — удалить все breakpoint'ы.

---

* [Python Debugging With Pdb](https://realpython.com/python-debugging-pdb/) (статья написана не индусом, что уже ее делает хорошей)

Так же можно использовать [pudb](https://documen.tician.de/pudb/) — лучший отладчик питоновского кода для терминала.

Его лучше поставить через `pipx` так как версия в репозитории арча, внезапно, нерабочая:

```sh
pipx install --system-site-packages pudb
```

* `--system-site-packages` позволяет использовать системные пакеты внутри виртуального окружения в которое был установлен `pudb`.

Для его запуска можно использовать привязку:

```vim
nnoremap <leader>pd :term pudb %<CR>
```

Для более сложных случаев лучше использовать более универсальные решения.

#### vimspector

[vimspector](https://github.com/puremourning/vimspector) — это порт стандартного отладчика VSCode для Vim. Главным его недостатком является использование **Node.js**, а достоинством — универсальность.

```vim
Plug 'puremourning/vimspector'
```

И используем стандартные сочетания клавиш VSCode:

```vim
let g:vimspector_enable_mappings = 'VISUAL_STUDIO'
```

| Сочетание | Описание |
| --- | --- |
| `F5` | Начать/продолжить отладку |
| `Shift-F5` | Прервать |
| `F9` | поставить breakpoint |


* [Сочетания клавиш](https://github.com/puremourning/vimspector?tab=readme-ov-file#visual-studio--vscode)

Для отладки кода на Python нужен `debugpy`. Его нужно установить через vim:

```vim
:VimspectorInstall debugpy
```

Для запуска отладчика нужен конфиг. Пример для Python:

`.vimspector.json`
```json
{
  "configurations": {
    "Python: Current File": {
      "adapter": "debugpy",
      "configuration": {
        "type": "python",
        "request": "launch",
        "program": "${file}",
        "console": "integratedTerminal"
      },
      "breakpoints": {
        "exception": {
          "raised": "",
          "uncaught": "Y",
          "userUnhandled": "N"
        }
      }
    }
  }
}
```

### Справка по командам

**Основные операции**

| Команда          | Описание |
|------------------|----------|
| `i`             | Перейти в режим вставки |
| `a`             | Вставить после курсора |
| `I`             | Вставить в начало строки |
| `A`             | Вставить в конец строки |
| `o`             | Новая строка ниже |
| `O`             | Новая строка выше |
| `r`             | Заменить символ |
| `R`             | Режим замены |
| `x`             | Удалить символ |
| `dd`            | Удалить строку |
| `yy`            | Копировать строку |
| `p`             | Вставить после |
| `P`             | Вставить до |
| `u`             | Отменить |
| `<C-r>`        | Повторить |
| `J`             | Объединить строки |

**Команды в режиме вставки**

| Комбинация      | Описание |
|-----------------|----------|
| `<C-h>`        | Удалить символ перед курсором |
| `<C-w>`        | Удалить слово перед курсором |
| `<C-j>`        | Вставить разрыв строки |
| `<C-t>`        | Увеличить отступ (сдвиг вправо) |
| `<C-d>`        | Уменьшить отступ (сдвиг влево) |
| `<C-n>`        | Автодополнение (следующий вариант) |
| `<C-p>`        | Автодополнение (предыдущий вариант) |
| `<C-r>x`       | Вставить содержимое регистра x |
| `<C-o>x`       | Временно перейти в нормальный режим для выполнения команды x |
| `<Esc>`/`<C-c>`| Выйти из режима вставки |

**Изменение регистра текста**

| Команда          | Описание |
|------------------|----------|
| `~`             | Изменить регистр символа под курсором |
| `g~`            | Изменить регистр для движения (например `g~w` - для слова) |
| `gu`            | В нижний регистр (например `guw` - для слова) |
| `gU`            | В верхний регистр (например `gUw` - для слова) |
| `v{motion}U`    | Визуально выделить текст и перевести в верхний регистр |
| `v{motion}u`    | Визуально выделить текст и перевести в нижний регистр |
| `v{motion}~`    | Визуально выделить текст и инвертировать регистр |
| `:%s/\<./\u&/g` | Сделать первую букву каждого слова заглавной |

**Навигация по тексту**

| Команда          | Описание |
|------------------|----------|
| `h,j,k,l`       | Движение курсора |
| `w`             | На слово вперед |
| `b`             | На слово назад |
| `e`             | В конец слова |
| `0`             | В начало строки |
| `^`             | К первому символу строки |
| `$`             | В конец строки |
| `gg`            | В начало файла |
| `G`             | В конец файла |
| `:<номер>`      | Перейти на строку |
| `%`             | Перейти к парной скобке |
| `f<символ>`     | Найти символ в строке |
| `t<символ>`     | До символа в строке |

**Работа с окнами и вкладками**

| Команда          | Описание |
|------------------|----------|
| `:split`        | Горизонтальное разделение |
| `:vsplit`       | Вертикальное разделение |
| `<C-w>h/j/k/l` | Переключение окон |
| `<C-w>c`       | Закрыть окно |
| `<C-w>o`       | Закрыть все окна кроме текущего |
| `:tabnew`       | Новая вкладка |
| `gt`            | Следующая вкладка |
| `gT`            | Предыдущая вкладка |
| `:tabm <номер>` | Переместить вкладку |

**Работа с буферами**

| Команда          | Описание |
|------------------|----------|
| `:bn`           | Следующий буфер |
| `:bp`           | Предыдущий буфер |
| `:bd`           | Закрыть буфер |
| `<C-^>`        | Переключение на ранее открытый буфер |
| `:ls`           | Список буферов |
| `:b <имя>`      | Перейти к буферу |

**Поиск и замена**

| Команда          | Описание |
|------------------|----------|
| `/текст`        | Поиск вперед |
| `?текст`        | Поиск назад |
| `n`             | Следующее совпадение |
| `N`             | Предыдущее совпадение |
| `*`             | Поиск слова под курсором вперед |
| `#`             | Поиск слова под курсором назад |
| `:%s/old/new/g` | Глобальная замена |
| `:s/old/new/g`  | Замена в текущей строке |
| `:s/old/new/gc` | Замена с подтверждением |

**Визуальный режим**

| Команда          | Описание |
|------------------|----------|
| `v`             | Визуальный режим (символьный) |
| `V`             | Визуальный режим (строчный) |
| `<C-v>`        | Визуальный режим (блочный) |
| `y`             | Копировать выделенное |
| `d`             | Удалить выделенное |
| `<`, `<<`, `>>`, `>` | Изменение отступов |
| `{`, `}` | Переход между блоками |

**Макросы**

| Команда          | Описание |
|------------------|----------|
| `q<буква>`      | Начать запись макроса |
| `@<буква>`      | Выполнить макрос |
| `@@`            | Повторить последний макрос |

**Работа с системой**

| Команда          | Описание |
|------------------|----------|
| `:w`            | Сохранить |
| `:q`            | Выйти |
| `:wq`           | Сохранить и выйти |
| `:x`            | Сохранить (если были изменения) и выйти |
| `ZZ`            | Сохранить и выйти |
| `ZQ`            | Выйти без сохранения |
| `:e <файл>`     | Открыть файл |
| `:r <файл>`     | Вставить содержимое файла |
| `:!команда`     | Выполнить shell-команду |
| `:r !команда`   | Вставить вывод команды |

**Проверка правописания**

| Команда | Действие                             |
|---------|--------------------------------------|
| `:set spell`/`:set nospell` | Включить/отключить проверку правописания |
| `[s`    | Перейти к предыдущей орфографической ошибке |
| `]s`    | Перейти к следующей орфографической ошибке  |
| `z=`    | Показать варианты исправлений для слова под курсором |
| `zg`    | Добавить слово в словарь (пометка как правильного) |
| `zw`    | Пометить слово как ошибочное (удалить из словаря) |
| `zug`   | Отменить последнее добавление слова (`zg`) |
| `zuw`   | Отменить последнюю пометку как ошибочное (`zw`) |

**Прочие команды**

| Команда          | Описание |
|------------------|----------|
| `gf`            | Перейти к файлу под курсором |
| `gx`            | Открыть URL под курсором |
| `K`             | Просмотр man-страницы |
| `m<буква>`      | Установить метку |
| ```<буква>`      | Перейти к метке |
| `'.`            | Перейти к последнему изменению |
| `:set paste`    | Режим вставки (для копирования извне) |
| `:set nopaste`  | Выключить режим вставки |

* [Vim Cheat Sheet](https://vim.rtorr.com/)

### Заметки

* [Кратко о Vim](https://ru.wikibooks.org/wiki/Vim)
* [Vimscript за 5 минут](https://learnxinyminutes.com/vimscript/)
* [Как пользоваться макросами](https://learnbyexample.github.io/vim_reference/Macro.html)

